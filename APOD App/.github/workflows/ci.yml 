name: iOS CI

# Trigger CI on push or pull request to main branch
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    # Use a Mac runner because we need Xcode
    runs-on: macos-latest

    steps:
      # Step 1: Checkout your repo
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Setup Xcode
      - name: Select Xcode
        run: sudo xcode-select -s /Applications/Xcode.app

      # Step 3: Install dependencies (if using CocoaPods)
      - name: Install CocoaPods dependencies
        run: |
          sudo gem install cocoapods
          pod install --project-directory="APOD App"

      # Step 4: Build the app in the simulator
      - name: Build App
        run: |
          xcodebuild \
            -workspace "APOD App.xcworkspace" \
            -scheme "APOD App" \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,name=iPhone 14' \
            build

      # Step 5 (Optional): Run tests
      - name: Run Unit Tests
        run: |
          xcodebuild \
            -workspace "APOD App.xcworkspace" \
            -scheme "APOD App" \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,name=iPhone 14' \
            test
