name: iOS CD (Unsigned IPA Delivery)

on:
  push:
    branches: [ main ]

jobs:
  cd:
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v3

      - uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: latest-stable

      - name: Build for Release (Unsigned)
        run: |
          xcodebuild \
            -scheme "APOD App" \
            -configuration Release \
            -sdk iphoneos \
            CODE_SIGNING_ALLOWED=NO \
            CODE_SIGNING_REQUIRED=NO \
            CODE_SIGN_IDENTITY="" \
            clean build

      - name: Package Unsigned IPA
        run: |
          mkdir -p Payload
          cp -R build/Release-iphoneos/*.app Payload
          zip -r APOD-App-unsigned.ipa Payload

      - name: Upload Unsigned IPA
        uses: actions/upload-artifact@v3
        with:
          name: unsigned-ipa
          path: APOD-App-unsigned.ipa

